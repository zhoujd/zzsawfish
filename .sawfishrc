;;;This is sawfish configure for zhoujd
;;;Create by zhoujd on 20120803

;;zzsawfish home
(setq zzsawfish-path "~/zzsawfish/")

;;add load-path
(setq load-path (cons (concat zzsawfish-path "lisp") load-path))

(require 'sawfish.wm.menus)
(setq capture-menu  
      '(("current window"  (capture-this-window))  
        ("region"          (capture-region))  
        ("full screen"     (capture-root-window))))  

(require 'iswitch-window)
(bind-keys global-keymap "Super-0" 'iswitch-window)

;;font set
(setq default-font (get-font "-*-Microsoft YaHei Mono-medium-r-*-*-14-*-*-*-*-*-*-*"))

;;set frame default style
(setq default-frame-style 'Crux)

;;set backgound
(setq background-list '("warty-final-ubuntu.png" "ubuntu-boot.png"))
(system (concat zzsawfish-path "/bin/habak-amd64 -ms " zzsawfish-path (nth 0 background-list) " &"))

;;capture screen
(defun capture-root-window ()  
  "capture root window"  
  (interactive)  
  (system "import -window root shot.png; display shot.png&"))  

(defun capture-this-window ()  
  "capture active window"  
  (interactive)  
  (let ((w (current-event-window)))  
    (when w  
      (display-message (concat "import -window "  
                        (prin1-to-string (window-id w)) " window.png"))  
      (system (concat "import -window "  
                      (prin1-to-string (window-id w)) " window.png"))  
      (system "display window.png&"))))  

(defun capture-region ()  
  "capture region"  
  (interactive)  
  (let ((process (make-process standard-output)  
    (start-process process "import" "capture.png")))))  

;;set start program
(define startup-programs  
  '(("gnome-panel")
    ("nm-applet")
    ("bluetooth-applet")
    ("xscreensaver" "-no-splash")
    ("/usr/lib/vino/vino-server" "--sm-disable")  ;;for remote desktop
    ("gnome-settings-daemon")   ;;for ubuntu 11.04 use gtk
    ("gnome-keyring-daemon")
    ("numlockx")
    ))

(add-hook 'before-exit-hook  
          (lambda ()  
            (mapc stop-process (active-processes))))

(mapc (lambda (program)  
        (apply start-process (make-process standard-output) program))  
      startup-programs) 

(add-hook 'before-exit-hook  
          (lambda ()  
            (mapc stop-process (active-processes))))

;; this function is used a bit further in, in my local config. i use it to blur
;; the line between what's running and what needs to be started, so i can hit a
;; key to load something, or jump to it if it was already running. i love
;; sawfish.
(defun jump-or-exec (re prog #!optional onfocused)
  "jump to a window matched by re, or start program otherwise."
  (catch 'return
    (let ((wind (get-window-by-name-re re)))
      (if (functionp onfocused) ; check if already focused
          (let ((curwin (input-focus)))
            (if curwin
                (if (string-match re (window-name curwin))
                    (progn
                      (funcall onfocused wind)
                      (throw 'return))))))
      (if (windowp wind)
          (display-window wind)
        (if (functionp prog)
            (funcall prog)
          (system (concat prog "&")))))))

;; define functions
(defun backgroundize (string)
  "Append a character `&' to STRING if it is not end with a `&'."
  (let ((len (length string)))
    (if (string= "&" (substring string (- len 1)))
        string
        (concat string " &"))))

(defun show-desktop-toggle ()
  "Show or hide the desktop."
  (if (showing-desktop-p)
      (hide-desktop)
      (show-desktop)))

(setq apps-menu-autogen   nil)
(setq decorate-transients t)
(setq place-window-mode   'first-fit)

(setq root-menu
      '(("Workspaces" . workspace-menu)
        ("Windows"    . window-menu)
        ("Programs"   . apps-menu)
        ("Customize"  . custom-menu)
        ("About..."   (customize 'about))
        ()
        ("Restart"    restart)
        ("Quit"       quit)))

(setq apps-menu  
      '(("Terminal"   (system "gnome-terminal &"))  
        ("Emacs"      (system "emacs &"))  
        ("Firefox"    (system "firefox &"))  
        ("Bcompare"   (system "bcompare &"))
        ("Evince"     (system "evince &"))
        ("Monitor"    (system "gnome-system-monitor &"))
        ("Gcolor2"    (system "gcolor2 &"))  
        ("Gcalctool"  (system "gcalctool &"))
        ("Capture"    (popup-menu capture-menu))  
        ()
        ("Run"        (system "gmrun &"))
        ("Lock"       (system "xscreensaver-command -lock &"))
        )) 

(bind-keys root-window-keymap "button3-click1" 'popup-root-menu)
(bind-keys window-keymap      "Meta-F10"       'maximize-window-fullscreen-toggle)

(bind-keys global-keymap
           "Super-TAB"   'cycle-windows
           "Super-Right" 'next-workspace
           "Super-Left"  'previous-workspace
           "Super-Down"  'lower-window
           "Super-Up"    'raise-window

           ;;window 
           "Super-F1"    'popup-root-menu
           "Super-F2"    '(system "gmrun &")
           "Super-F3"    '(show-desktop-toggle)
           "Super-F4"    '(delete-window (current-event-window))

           "Super-F10"   '(maximize-window-toggle (current-event-window))

           "Super-Menu"  'popup-window-menu
           "C-Menu"      'popup-root-menu
           "S-Menu"      'popup-apps-menu
           
           "Super-Home"  '(jump-or-exec "Nautilus" "nautilus --no-desktop ~" t)
           "Super-l"     '(system "xscreensaver-command -lock &")
           "Super-x"     '(system "xkill &"))

;;for run special program
(define exec-keymap (make-keymap))
(bind-keys global-keymap "Super-e" exec-keymap)
(bind-keys exec-keymap
           "e"    '(system "emacs &")
           "t"    '(system "gnome-terminal &")
           "n"    '(system "nautilus --no-desktop ~ &")
           "f"    '(jump-or-exec "Firefox" "firefox")
           "b"    '(jump-or-exec "Beyond Compare" "bcompare")           
           "g"    '(jump-or-exec "Geany" "geany" t)
           "G"    '(jump-or-exec "GPRename" "gprename" nil)
           
           "F2"   '(system "gksu &")
           "F9"   '(jump-or-exec "Synaptic" "gksu -u root synaptic" nil)
           "F10"  '(jump-or-exec "Gtkorphan" "gksu -u root gtkorphan" t)
           "F11"  '(system "gksu -u root /etc/init.d/network-manager restart &")
           "F12"  '(system "gksu -u root /etc/init.d/privoxy restart &"))

;;for menus control
(define menus-keymap (make-keymap))
(bind-keys global-keymap "Super-m" menus-keymap)
(bind-keys menus-keymap
           "1"    'popup-root-menu
           "2"    'popup-window-menu
           "3"    'popup-apps-menu)


;;;~/.sawfishrc end here
